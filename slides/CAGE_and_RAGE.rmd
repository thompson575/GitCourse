---
title: "The CAGE & RAGE Projects"
author: "John Thompson"
date: "2023-03-29"
output:
  xaringan::moon_reader:
    self-contained: true
    css: ["metropolis", "style.css"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
xaringanExtra::use_panelset()
```

#CAGE

**C**lassification **A**fter **G**ene **E**xpression

## Aim

- To explore ways of selecting features from a gene expression study for later use in patient classification.  

<br>

- To investigate the pros and cons of features based on the principal components of the gene expression.

---
# Data Source

<br>
The gene expression data come from,

Xu K, Shi X, Husted C, Hong R et al.  
**Smoking modulates different secretory subpopulations expressing SARS-CoV-2 entry genes in the nasal and bronchial airways.**  
Sci Rep 2022 Oct 28;12(1):18168. 

GEO archive as GSE210271. **Series Matrix File** downloaded from <https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE210271>.  

---
#Study Design

<br>
- mRNA gene expression from 505 nasal epithelial brushings  
<br>
- Profiled using Affymetrix Gene 1.0 ST microarrays .. 21685 probes   
<br>
- Patients in the Airway Epithelial Gene Expression in the Diagnosis of Lung Cancer (AEGIS) trials (AEGIS-1 and AEGIS-2)  
<br>
- AEGIS-1: 243 with lung cancer, 132 with benign lung disease   <br>
- AEGIS-2: 66 with lung cancer, 64 with benign lung disease  

---
#Project Plan
<br>
* Use AEGIS-1 for training and AEGIS-2 for validation   
<br>
* Develop the analysis on a sub-sample of 1000 probes  
<br>
* Predict Cancer/Benign using Logistic Regression (LR)  
<br>
* Compare 3 methods  
  - Rank Probes .. Select the M best probes for LR  
  - PCA .. Select first M PCs for LR  
  - Rank PCs .. Select the M best PCs for LR  
<br>
* Once code is working, use same workflow on all 21,685 probes  

---
#Loss Function  

Compare models using the Cross-Entropy Loss  

$$
  -\frac{1}{N} \sum_{i=1}^N y_i log(\hat{y}_i) + (1-y_i) log(1-\hat{y}_i)
$$

N is the number of subjects,  
$y_i$ is 0 for benign cases and 1 for cancer cases  
$\hat{y}_i$ is the predicted probability of the case being cancer under whatever model is being used  

- Measures the average prediction error  
- Equivalent to -log-Likelihood of the binomial distribution used in logistic regression
---
#Documentation

<br>
- Commented Scripts, Diary, Dashboard, Reports on all intermediate stages  
<br>
- Slide presentation on the final analysis  
<br>
- Draft journal article  (PLoS)  
<br>
- Website describing the project  
---
# Workflow Diagram

```{r echo = FALSE, fig.align='center', fig.height=8, fig.width=10}
library(DiagrammeR)

grViz("
digraph G {
graph[   rankdir = LR;]
subgraph cluster_1 {
label = 'Data Folder'
fontsize = 20;
fontcolor = 'blue';
   node [shape = rectangle,
      style = filled,
      width = 2.5,
      height = 1.5,
      color = beige]
a3 [style=invis]
b3  [label = 'subject.rds expression.rds\ntraining.rds validation.rds']
c3  [label = 'subset_pca.rds\nsubset_train_pca_scores.rds\nsubset_valid_pca_scores.rds']

edge[style=invis, rankdir=TB];
a3 -> b3 -> c3;
}
subgraph cluster_2 {
label = 'Code/Report Folders'
fontsize = 20;
fontcolor = 'blue';
   node [shape = rectangle,
      style = filled,
      width = 2,
      height = 1,
      color = cyan]
a  [label = 'Project Setup\nREADME.md\nLICENSE.md']
b  [label = 'Read Data\nread_data.R\ndata_report.rmd']
c  [label = 'Unscaled PCA\npca.R\npca_report.rmd']
edge[style=invis, rankdir=TB];
a -> b -> c;
}
subgraph cluster_3 {
label = 'Local Repo'
fontsize = 20;
fontcolor = 'blue';
node[ style = filled,
      width = 1,
      color = yellow,
      label = '  ']
a1 b1 c1
edge[style=invis, rankdir=TB];
a1 -> b1 -> c1
}
subgraph cluster_4 {
label = 'Github'
fontsize = 20;
fontcolor = 'blue';
node[ style = filled,
      width = 1,
      color = green,
      label = '  ']
a2 b2 c2
edge[style=invis, rankdir=TB];
a2 -> b2 -> c2
}
a -> a1 -> a2
b -> b1 -> b2
c -> c1 -> c2
b -> b3
c -> c3
b3 -> c
}")
```

---
#RAGE

**R**egression **A**fter **G**ene **E**xpression

##Aim

- To explore ways of selecting features from a gene expression study for prediction of a patient characteristic.  

<br>
- To investigate the pros and cons of features based on the principal components of the gene expression.

---
# Data Source

<br>
The gene expression data come from,

Sayed N, Huang Y, Nguyen K, Krejciova-Rajaniemi Z et al.  
**An inflammatory aging clock (iAge) based on deep learning tracks multimorbidity, immunosenescence, frailty and cardiovascular aging.**  
Nat Aging 2021 Jul;1:598-615.  

GEO archive as GSE168753. File **GSE168753_processed_data.csv.gz** from https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE168753.  

---
#Study Design

<br>
- 312 individuals  
<br>
- Profiled using Illumina HumanHT-12 V4.0 expression beadchip  
<br>
- Processed data has expression for 5000 genes  
<br>
- Subject characteristics include, age, sex, BMI    

---
#Project Plan
<br>
* Use gene level expression to predict BMI     
<br>
* Develop the analysis on a sub-sample of 1000 genes  
<br>
* Use 200 subjects for training the models and 112 subjects for validation  
<br>
* Predict BMI using Linear Regression  (LReg)  
<br>
* Compare 3 methods  
  - Rank Genes .. Select the M best genes for LReg  
  - PCA .. Select first M PCs for LReg  
  - Rank PCs .. Select the M best PCs for LReg  
<br>
* Once code is working, use same workflow on all 5000 genes and 312 subjects    

---
#Loss Function  

Compare models using the Least Squares Loss  

$$
  \frac{1}{N} \sum_{i=1}^N (y_i -\hat{y}_i)^2 
$$

N is the number of subjects,  
$y_i$ is the BMI  
$\hat{y}_i$ is the predicted BMI under whatever model is being used  

- Measures the average prediction error  
- Equivalent to -log-Likelihood of the normal distribution used in linear regression

---
#Documentation

<br>
- Commented Scripts, Diary, Dashboard, Reports on all intermediate stages  
<br>
- Slide presentation on the final analysis  
<br>
- Draft journal article  (PLoS)  
<br>
- Website describing the project  
