---
title: "Archiving overview"
author: "John Thompson"
date: "9th Febuary 2023"
output:
  xaringan::moon_reader:
    self-contained: true
    css: ["metropolis", "style.css"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.align='center')
```


# The Problem

.center[![](cartoon1.png)]

---
# Homemade Archive


### Working Folder  

read_data.R  
explore_data.R  
fit_glms.R


### Archive  

read_data_2023_01_20.R  
explore_data_2023_01_20.R  
explore_data_2023_01_24.R  
fit_glms_2023_01_24.R  
fit_glms_2023_01_26.R  
fit_glms_2023_01_27.R  

---
# Pros and Cons of a Homemade Archive

### Benefits

- One active copy of each file (no confusion over which to run)   
- Dated (able to reproduce earlier analyses)  
- Perhaps, it fulfils 80% of your needs

### Limitations

- Restoring to an earlier date has to be done manually  
- Not clear what changed between versions or why they were archived    
- Difficult to work on two developments at the same time
- Not designed for sharing/collaboration  
  - who made what changes  
  - who has overall control  
  - possible conflicts if two people simultaneously change a working version  
- This archiving system is not widely used    
- This archiving system is not integrated into RStudio or VSCode  
---
# Professional Archiving of Code

<br>

- **git**, **subversion (SVN)** and **mercurial** are all free and they create similar, but not compatible, code archives

- **git** is the most widely used  

- **git** was written by software developers for software developers  

- the terminology of **git** can be off-putting for data scientists  

- **git** is designed for code (text files). It is not suitable for archiving data  

- **git** archives are project specific  

- **git** can create local archives (on your computer) or remote archive (on a shared drive or in the cloud)  

---
# Web-based Archives

<br>

- **github**, **bitbucket**, **gitlab**, **sourceforge** and many others, offer cloud-based hosting of remote **git** archives  

- **github** is the most widely used  

- **github** is independent of **git**  

- **githib** is ideal for collaboration and dissemination  

- archives copied to **github** can be private, but there is a strong case for making research archives public whenever possible  

- **github** encourages openness in data analysis    

---
# Git Terminology  

<br>

git term   |   meaning  
------------------|--------------------------------  
**repository**   (repo) | an archive  
**local**             | on your computer  
**remote**            | not on your computer e.g. in the cloud  
**to commit**         | to save/update the file(s) in an archive  
**to stage**          | to mark a file for inclusion in the next commit  
**.gitignore**         | text file listing files or file types that git will ignore when committing  

<br>
<br>

A local git repo is just a (hidden) folder called **.git** within your project folder. **Do not play with the contents!!**  

---
# Main Branch

Soon you will have a chain of commits called the main (master) branch

```{r echo = FALSE, fig.align='center'}
library(DiagrammeR)

grViz("
digraph dot {

graph [layout = dot,
       rankdir = LR]

node [shape = square,
      style = filled,
      color = cyan,
      label = 'Commit 1']
a

node [shape = square,
      style = filled,
      color = cyan,
      label = 'Commit 2']
b

node [shape = square,
      style = filled,
      color = cyan,
      label = 'Commit 3']
c


edge [color = black]
a -> {b}
b -> {c}
}")
```


---
# Extra Branches

Most local repos only have one branch  

but, perhaps you will want to go back to commit 2 and work on an alternative version of the code. This would create a new branch.  

If both developments are useful, you might decide to merge the branches  

Separate branches are most useful in remote repos when two people are able to collaborate on a project  

```{r echo = FALSE}
library(DiagrammeR)

grViz("
digraph dot {

graph [layout = dot,
       rankdir = LR]

node [shape = square,
      style = filled,
      color = cyan,
      label = 'Commit 1']
a

node [shape = square,
      style = filled,
      color = cyan,
      label = 'Commit 2']
b

node [shape = square,
      style = filled,
      color = cyan,
      label = 'Commit 3']
c

node [shape = square,
      style = filled,
      color = cyan,
      label = 'Commit 4']
d

node [shape = square,
      style = filled,
      color = cyan,
      label = 'Commit 5']
e

node [shape = square,
      style = filled,
      color = cyan,
      label = 'Merge']
f

edge [color = black]
a -> {b}
b -> {c d}
d -> {e}
c -> {f}
e -> {f}
}", height=200)
```

---
# More Git Terminology

<br>

git term   |   meaning  
------------------|--------------------------------
**branch**  | a chain of commits  
**main branch**             | the original chain between the start and the most developed form of the code    
**merge**   | combine two branches  
**HEAD**            | the commit that you are currently working on  
**diff**     | the changes between any two commits  

---

# Git Interfaces

* Via a **terminal** using linux style commands  
  - git commit -m "Initial Commit"  
  - does everything but not easy to learn  
* Via a git **client**  
  - graphical interface .. click and drag  
  - https://git-scm.com/download/gui/windows   
  - many are free  
* Via **RStudio**  
  - git tab - very basic git client  
  - terminal tab - for more advanced tasks  

---
# Github Terminology

Remote copy of a local repo

github term   |   meaning  
------------------|--------------------------------  
**push**  | sync by copying from your local repo to your github repo  
**pull**  | sync by copying from your github repo to your local git repo  

<br>

```{r echo = FALSE}
library(DiagrammeR)

grViz("
digraph dot {

graph [layout = dot,
       rankdir = TB]

node [shape = rectangle,
      style = filled,
      fillcolor = beige,
      color = black,
      height = 0.3,
      width = 1,
      label = 'Your\nGithub Repo', fontsize=7]
a

node [shape = rectangle,
      style = filled,
      fillcolor = azure,
      color = black,
      height = 0.3,
      width = 1,
      label = 'Your\nLocal git repo', fontsize=7]
b


edge [color = black]
a -> {b}[label = '  pull         ', fontsize=9]
b -> {a}[label = '   push  ', fontsize=9]
}", height = 350)
```


---
# More Github Terminology

github term   |   meaning  
------------------|--------------------------------  
**clone** | make a local copy of a github repo  
**fork**  | copy another user's github repo to your own github account     

```{r echo = FALSE}
library(DiagrammeR)

grViz("
digraph dot {

graph [layout = fdp,
       rankdir = TB]

node [shape = rectangle,
      style = filled,
      fillcolor = beige,
      color = black,
      label = 'Another\nGithub Repo',
      fontsize = 8]
c

node [shape = rectangle,
      style = filled,
      fillcolor = beige,
      color = black,
      label = 'Your\nGithub Account',
      fontsize = 8,
      size = 1]
a

node [shape = rectangle,
      style = filled,
      fillcolor = azure,
      color = black,
      label = 'Your\nLocal Computer',
      fontsize = 8]
b




edge [color = black]
c -> {a}[label = 'fork', fontsize = 8, arrowsize=0.5, color=blue, fontcolor=blue]
c -> {b}[label = ' clone ', fontsize = 8, arrowsize=0.5, color=blue, fontcolor=blue]
}", height=350)
```

---

# Github Services  

service  |   meaning  
------------------|--------------------------------  
**Issue** | message pointing out bugs or suggesting improvements      
**Pull request** | message to ask the owner to merge code that you have changed  
**Project**  | spreadsheet for organising issues and pull requests  
**Codespace**  | cloud computing provided by github   
**Action** | task performed automatically in response to some trigger    
**Pages** |  hosts a website linked to a repository    
**LFS**  | Large File Storage for data (separate download https://git-lfs.com/)   

<br>

**All Free** but with restrictions. For example, a free account has 120 core hours per month of Codespace, Free LFS is limited to 1GB.  

Github file size limited to 50MB. Repository size limited to 1GB. An account can have any number of repos.  